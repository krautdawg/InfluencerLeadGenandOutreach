<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K+L Influence - Lead Generation</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- K+L Influence Style Guide CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='kl-influence-style.css') }}">
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="top-nav">
        <button class="mobile-menu-toggle" id="mobileMenuToggle">
            <i class="fas fa-bars"></i>
        </button>
        <div class="nav-logo">
            <img src="{{ url_for('static', filename='kl-influence-logo.png') }}" alt="K+L Influence">
        </div>
        <div class="nav-links">
            <button type="button" class="btn btn-primary" id="promptSettingsBtn" style="margin-right: 10px;">
                <i class="fas fa-cogs"></i>
                Prompt Einstellungen
            </button>
            <button type="button" class="btn btn-primary" id="productManageBtn" style="margin-right: 10px;">
                <i class="fas fa-box"></i>
                Produkte verwalten
            </button>
            <button type="button" class="btn btn-connection" id="sessionStatus">
                <img src="{{ url_for('static', filename='instagram-icon.svg') }}" alt="Instagram" class="instagram-icon">
                <span id="sessionStatusText">
                    {% if ig_sessionid %}
                        Verbunden ({{ ig_sessionid[:8] }}...)
                    {% else %}
                        Nicht verbunden
                    {% endif %}
                </span>
            </button>
            <a href="/logout" class="btn btn-secondary" style="margin-left: 10px;">
                <i class="fas fa-sign-out-alt"></i>
                Logout
            </a>
        </div>
    </nav>

    <!-- Main Layout -->
    <div class="app-layout" id="appLayout">
        <!-- Sidebar Toggle Button (outside sidebar to avoid transform issues) -->
        <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar" aria-expanded="true">
            <i class="fas fa-chevron-left" id="toggleIcon"></i>
        </button>
        
        <!-- Sidebar Navigation -->
        <nav class="sidebar-nav" id="sidebarNav">
            <!-- Lead Generation Section -->
            <div class="sidebar-section">
                <h3>Lead Generation</h3>
                <div class="form-group">
                    <label for="keywordInput">Stammhashtag</label>
                    <input type="text" class="form-control" id="keywordInput" placeholder="z.B. vitalpilze">
                </div>
                <div class="form-group">
                    <label for="searchLimitInput">Anzahl hashtag Varianten</label>
                    <input type="number" class="form-control" id="searchLimitInput" value="5" min="1" max="50">
                    <small class="form-text">Max 10 (wegen Anti-Spam Filter)</small>
                </div>

                <button type="button" class="btn btn-primary w-100 btn-icon" id="runButton">
                    <i class="fas fa-play"></i>
                    <span>Leads generieren</span>
                </button>
            </div>

            <!-- Processing Status -->
            <div id="processingStatus" class="sidebar-section" style="display: none;">
                <div class="card" style="background-color: var(--color-pale-green);">
                    <div class="d-flex align-items-center gap-3">
                        <div class="spinner"></div>
                        <div>
                            <div id="statusText" style="font-weight: 600;">Processing...</div>
                            <div id="progressText" style="font-size: var(--text-body-sm); color: var(--color-medium-gray);"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Emergency Restart Section -->
            <div class="sidebar-section" style="margin-top: auto; padding-top: var(--space-lg); border-top: 1px solid var(--color-light-gray);">
                <div class="emergency-restart-container">
                    <button type="button" class="btn btn-emergency w-100 btn-icon" id="emergencyRestartBtn">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Server Neu starten</span>
                    </button>
                    <small class="form-text text-center" style="color: var(--color-medium-gray); margin-top: 8px;">
                        Nur bei Problemen verwenden
                    </small>
                </div>
            </div>

        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Results Container for dynamic content -->
            <div id="resultsContainer">
                <!-- Results Section -->
                <div id="resultsSection" style="display: none;">
                    <!-- Action Bar -->
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="mb-0">Lead Ergebnisse</h2>
                        <div class="d-flex gap-2 align-items-center">
                            <div class="form-check me-3">
                                <input class="form-check-input" type="checkbox" id="filterPersonalOnly" checked>
                                <label class="form-check-label" for="filterPersonalOnly" style="font-size: 14px; color: var(--color-medium-gray);">
                                    Nur Personal
                                </label>
                            </div>
                            <button type="button" class="btn btn-secondary btn-sm" onclick="clearFilters()">
                                <i class="fas fa-filter"></i> Filter löschen
                            </button>
                            <button type="button" class="btn btn-secondary btn-sm" onclick="window.open('/export/csv', '_blank')">
                                <i class="fas fa-file-csv"></i> CSV Export
                            </button>
                            <button type="button" class="btn btn-tertiary btn-sm" onclick="clearData()">
                                <i class="fas fa-trash"></i> Alle löschen
                            </button>
                        </div>
                    </div>

                    <!-- Table Container -->
                    <div class="table-container">
                        <!-- Pagination Controls Top -->
                        <div class="pagination-controls-top" id="paginationControlsTop" style="display: none;">
                            <div class="pagination-info">
                                <span id="resultsInfo">Zeige 0-0 von 0 Ergebnissen</span>
                            </div>
                            <div class="pagination-navigation">
                                <button class="btn btn-sm" id="firstPageBtn">Erste</button>
                                <button class="btn btn-sm" id="prevPageBtn">Zurück</button>
                                <span id="pageInfo">Seite 1 von 1</span>
                                <div class="page-numbers" id="pageNumbers">
                                    <!-- Page numbers will be inserted here -->
                                </div>
                                <button class="btn btn-sm" id="nextPageBtn">Weiter</button>
                                <button class="btn btn-sm" id="lastPageBtn">Letzte</button>
                            </div>
                            <div class="pagination-size">
                                <label for="pageSizeSelect">Zeige:</label>
                                <select id="pageSizeSelect">
                                    <option value="10">10</option>
                                    <option value="25" selected>25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                    <option value="200">200</option>
                                    <option value="all">Alle</option>
                                </select>
                            </div>
                        </div>
                    <div class="table-wrapper" id="tableWrapper">
                        <table class="data-table" id="resultsTable">
                            <thead>
                                <tr>
                                    <th onclick="sortTable(0)" class="sortable">
                                        #<span class="sort-indicator">↕</span>
                                        <div class="resize-handle" data-column="1"></div>
                                    </th>
                                    <th onclick="sortTable(1)" class="sortable">
                                        Name/Benutzername<span class="sort-indicator">↕</span>
                                        <div class="resize-handle" data-column="2"></div>
                                    </th>
                                    <th onclick="sortTable(2)" class="sortable">
                                        hashtag<span class="sort-indicator">↕</span>
                                        <div class="resize-handle" data-column="3"></div>
                                    </th>
                                    <th onclick="sortTable(3)" class="sortable">
                                        Follower<span class="sort-indicator">↕</span>
                                        <div class="resize-handle" data-column="4"></div>
                                    </th>
                                    <th onclick="sortTable(4)" class="sortable">
                                        Email<span class="sort-indicator">↕</span>
                                        <div class="resize-handle" data-column="5"></div>
                                    </th>
                                    <th onclick="sortTable(5)" class="sortable">
                                        Website<span class="sort-indicator">↕</span>
                                        <div class="resize-handle" data-column="6"></div>
                                    </th>
                                    <th onclick="sortTable(6)" class="sortable">
                                        Post Datum<span class="sort-indicator">↕</span>
                                        <div class="resize-handle" data-column="7"></div>
                                    </th>
                                    <th onclick="sortTable(7)" class="sortable">
                                        Email Status<span class="sort-indicator">↕</span>
                                        <div class="resize-handle" data-column="8"></div>
                                    </th>
                                    <th>Aktionen<div class="resize-handle" data-column="9"></div></th>
                                </tr>
                                <tr class="filter-row">
                                    <th></th>
                                    <th><input type="text" class="filter-input" id="filterNameUsername" data-column="1" placeholder="Name oder @benutzername..."></th>
                                    <th><input type="text" class="filter-input" id="filterHashtag" data-column="2" placeholder="Filtern..."></th>
                                    <th>
                                        <select class="form-control filter-select" id="filterFollowersRange">
                                            <option value="">Alle Follower</option>
                                            <option value="1-100">1 - 100</option>
                                            <option value="100-1000">100 - 1K</option>
                                            <option value="1000-10000">1K - 10K</option>
                                            <option value="10000-50000">10K - 50K</option>
                                            <option value="50000-100000">50K - 100K</option>
                                            <option value="100000-500000">100K - 500K</option>
                                            <option value="500000-1000000">500K - 1M</option>
                                            <option value="1000000-999999999">1M+</option>
                                            <option value="custom">Benutzerdefiniert...</option>
                                        </select>
                                        <input type="text" class="filter-input" id="filterFollowers" data-column="3" placeholder="> < = 1000" style="display: none; margin-top: 5px;">
                                    </th>
                                    <th><input type="text" class="filter-input" id="filterEmail" data-column="4" placeholder="Filtern..."></th>
                                    <th><input type="text" class="filter-input" id="filterWebsite" data-column="5" placeholder="Filtern..."></th>
                                    <th>
                                        <select class="form-control filter-select" id="filterPostDate">
                                            <option value="">Alle Daten</option>
                                            <option value="letzte-woche">Letzte Woche</option>
                                            <option value="letzten-monat">Letzten Monat</option>
                                            <option value="dieses-jahr">Dieses Jahr</option>
                                            <option value="alter-als">Älter als...</option>
                                            <option value="benutzerdefiniert">Benutzerdefiniert</option>
                                        </select>
                                        <input type="date" class="filter-input" id="filterPostDateCustom" style="display: none; margin-top: 5px;" placeholder="Älter als Datum">
                                        <div id="customDateRange" style="display: none; margin-top: 5px;">
                                            <input type="date" class="filter-input" id="filterPostDateStart" placeholder="Von" style="margin-bottom: 3px;">
                                            <input type="date" class="filter-input" id="filterPostDateEnd" placeholder="Bis">
                                        </div>
                                    </th>
                                    <th>
                                        <select class="form-control filter-select" id="filterEmailStatus">
                                            <option value="">Alle Email-Status</option>
                                            <option value="nicht-gestartet">Nicht gestartet</option>
                                            <option value="entwurf">Entwurf bereit</option>
                                            <option value="gesendet">Gesendet</option>
                                        </select>
                                    </th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="resultsBody">
                                <!-- Results will be populated here -->
                            </tbody>
                        </table>
                    </div>
                        <!-- Pagination Controls Bottom -->
                        <div class="pagination-controls-bottom" id="paginationControlsBottom" style="display: none;">
                            <div class="pagination-info">
                                <span id="resultsInfoBottom">Zeige 0-0 von 0 Ergebnissen</span>
                            </div>
                            <div class="pagination-navigation">
                                <button class="btn btn-sm" id="firstPageBtnBottom">Erste</button>
                                <button class="btn btn-sm" id="prevPageBtnBottom">Zurück</button>
                                <span id="pageInfoBottom">Seite 1 von 1</span>
                                <div class="page-numbers" id="pageNumbersBottom">
                                    <!-- Page numbers will be inserted here -->
                                </div>
                                <button class="btn btn-sm" id="nextPageBtnBottom">Weiter</button>
                                <button class="btn btn-sm" id="lastPageBtnBottom">Letzte</button>
                            </div>
                            <div class="pagination-size">
                                <label for="pageSizeSelectBottom">Zeige:</label>
                                <select id="pageSizeSelectBottom">
                                    <option value="10">10</option>
                                    <option value="25" selected>25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                    <option value="200">200</option>
                                    <option value="all">Alle</option>
                                </select>
                            </div>
                        </div>
                </div>
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="text-center" style="padding: var(--space-3xl) 0;">
                    <i class="fas fa-inbox" style="font-size: 48px; color: var(--color-light-gray); margin-bottom: var(--space-lg);"></i>
                    <h3 style="color: var(--color-medium-gray);">Noch keine Leads generiert</h3>
                    <p style="color: var(--color-medium-gray);">Gib ein hashtag ein und klicke auf "Leads generieren", um zu beginnen</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Session ID Modal -->
    <div class="modal" id="sessionModal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h4 class="modal-title">Instagram Session Konfiguration</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="sessionInput">Instagram Session ID</label>
                    <input type="text" class="form-control" id="sessionInput" placeholder="Gib deine sessionid ein...">
                    <small class="form-text">
                        Zu finden in deinem Browser: Entwicklertools → Application → Cookies → instagram.com → sessionid
                    </small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('sessionModal')">Abbrechen</button>
                <button type="button" class="btn btn-primary" id="saveSession">Session speichern</button>
            </div>
        </div>
    </div>

    <!-- Edit Modal for Email Subject/Body -->
    <div class="modal" id="editModal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h4 class="modal-title" id="editModalTitle">Inhalt bearbeiten</h4>
                <button type="button" class="close" onclick="closeModal('editModal')" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label id="editModalLabel">Inhalt</label>
                    <textarea class="form-control" id="editModalContent" rows="10"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('editModal')">Abbrechen</button>
                <button type="button" class="btn btn-primary" onclick="saveEditModal()">Änderungen speichern</button>
            </div>
        </div>
    </div>

    <!-- Prompt Settings Modal -->
    <div class="modal" id="promptSettingsModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-header">
                <h4 class="modal-title">Prompt Einstellungen</h4>
                <button type="button" class="close" onclick="closeModal('promptSettingsModal')" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Prompt Type Selection -->
                <div class="form-group">
                    <label>Prompt Typ auswählen</label>
                    <div class="d-flex gap-4">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="promptMode" id="promptModeWithoutProduct" value="without_product" checked>
                            <label class="form-check-label" for="promptModeWithoutProduct">
                                Ohne Produkt
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="promptMode" id="promptModeWithProduct" value="with_product">
                            <label class="form-check-label" for="promptModeWithProduct">
                                Mit Produkt
                            </label>
                        </div>
                    </div>
                    <small class="form-text">Wähle, ob die E-Mails ein spezifisches Produkt erwähnen sollen.</small>
                </div>

                <!-- Email Type Selection -->
                <div class="form-group">
                    <label for="promptTypeSelect">E-Mail Typ</label>
                    <select class="form-control" id="promptTypeSelect">
                        <option value="subject">Betreff</option>
                        <option value="body">E-Mail Text</option>
                    </select>
                </div>

                <!-- System Message -->
                <div class="form-group">
                    <label for="systemMessage">System-Nachricht</label>
                    <textarea class="form-control" id="systemMessage" rows="6" placeholder="Gib die System-Anweisungen ein..."></textarea>
                    <small class="form-text">Diese Nachricht definiert, wie die KI den Text generieren soll.</small>
                </div>

                <!-- User Message Template -->
                <div class="form-group">
                    <label for="userTemplate">Benutzer-Nachricht Vorlage</label>
                    <textarea class="form-control" id="userTemplate" rows="3" placeholder="Gib die Vorlage für die Benutzer-Nachricht ein..."></textarea>
                    <small class="form-text">Diese Vorlage wird mit den Lead-Daten gefüllt.</small>
                </div>

                <!-- Available Variables -->
                <div class="form-group">
                    <label>Verfügbare Variablen:</label>
                    <div id="variablesList" class="variable-checkboxes">
                        <!-- Variables will be populated dynamically based on product selection -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('promptSettingsModal')">Abbrechen</button>
                <button type="button" class="btn btn-primary" id="savePromptSettings">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Product Edit Modal -->
    <div class="modal" id="productEditModal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h4 class="modal-title" id="productEditTitle">Produkt bearbeiten</h4>
                <button type="button" class="close" onclick="closeModal('productEditModal')" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="productEditId">
                <!-- Product Selector -->
                <div class="form-group">
                    <label for="productSelector">Produkt auswählen</label>
                    <select class="form-control" id="productSelector">
                        <option value="">-- Neues Produkt erstellen --</option>
                        <!-- Products will be populated dynamically -->
                    </select>
                    <small class="form-text">Wähle ein bestehendes Produkt zum Bearbeiten oder erstelle ein neues.</small>
                </div>
                <hr>
                <div class="form-group">
                    <label for="productName">Produkt Name</label>
                    <input type="text" class="form-control" id="productName" placeholder="Produkt Name eingeben...">
                </div>
                <div class="form-group">
                    <label for="productUrl">Produkt URL</label>
                    <input type="text" class="form-control" id="productUrl" placeholder="https://www.beispiel.de/produkt">
                </div>
                <div class="form-group">
                    <label for="productImageUrl">Bild URL</label>
                    <input type="text" class="form-control" id="productImageUrl" placeholder="https://www.beispiel.de/bild.jpg">
                </div>
                <div class="form-group">
                    <label for="productDescription">Beschreibung</label>
                    <textarea class="form-control" id="productDescription" rows="3" placeholder="Produkt Beschreibung..."></textarea>
                </div>
                <div class="form-group">
                    <label for="productPrice">Preis/Größe</label>
                    <input type="text" class="form-control" id="productPrice" placeholder="z.B. 50 ml">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('productEditModal')">Abbrechen</button>
                <button type="button" class="btn btn-primary" id="saveProduct">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Email Campaign Setup Modal -->
    <div class="modal" id="emailCampaignModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-header">
                <h4 class="modal-title" id="emailCampaignTitle">Email Campaign Setup</h4>
                <button type="button" class="close" onclick="closeModal('emailCampaignModal')" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="emailCampaignUsername">
                
                <!-- Lead Context Display -->
                <div class="alert alert-info mb-4">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-user me-2"></i>
                        <div>
                            <strong id="emailCampaignLeadName">Loading...</strong>
                            <small class="d-block text-muted" id="emailCampaignLeadInfo">@username • followers</small>
                        </div>
                    </div>
                </div>

                <!-- Product Selection -->
                <div class="form-group">
                    <label for="emailCampaignProductSelect">Produkt auswählen *</label>
                    <select class="form-control" id="emailCampaignProductSelect" required>
                        <option value="">-- Produkt auswählen --</option>
                        <!-- Products will be populated dynamically -->
                    </select>
                    <small class="form-text">Wähle das Produkt für diese Email-Kampagne aus.</small>
                </div>

                <!-- Product Preview -->
                <div id="emailCampaignProductPreview" class="card mb-4" style="display: none;">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <img id="emailCampaignProductImage" src="" alt="Product" class="me-3" style="width: 60px; height: 60px; object-fit: cover; border-radius: 6px;">
                            <div>
                                <h6 class="mb-1" id="emailCampaignProductName">Product Name</h6>
                                <p class="mb-1 text-muted small" id="emailCampaignProductDescription">Product description</p>
                                <small class="text-muted" id="emailCampaignProductPrice">Price</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Email Subject -->
                <div class="form-group">
                    <label for="emailCampaignSubject">Email Betreff *</label>
                    <div class="d-flex">
                        <input type="text" class="form-control me-2" id="emailCampaignSubject" placeholder="Gib den Email-Betreff ein..." required maxlength="100">
                        <button type="button" class="btn btn-secondary btn-sm" id="generateSubjectBtn" title="AI-Betreff generieren">
                            <i class="fas fa-magic"></i>
                        </button>
                    </div>
                    <small class="form-text">
                        <span id="subjectCharCount">0</span>/100 Zeichen
                    </small>
                </div>

                <!-- Email Content -->
                <div class="form-group">
                    <label for="emailCampaignContent">Email Inhalt *</label>
                    <div class="d-flex flex-column">
                        <div class="d-flex mb-2">
                            <button type="button" class="btn btn-secondary btn-sm me-2" id="generateContentBtn" title="AI-Inhalt generieren">
                                <i class="fas fa-magic"></i> AI generieren
                            </button>
                            <button type="button" class="btn btn-tertiary btn-sm" id="insertVariablesBtn" title="Verfügbare Variablen anzeigen">
                                <i class="fas fa-code"></i> Variablen
                            </button>
                        </div>
                        <textarea class="form-control" id="emailCampaignContent" rows="8" placeholder="Gib den Email-Inhalt ein..." required></textarea>
                    </div>
                    <small class="form-text">
                        <span id="contentCharCount">0</span> Zeichen • Verwende Variablen wie {username}, {product_name}, {product_url}
                    </small>
                </div>

                <!-- Available Variables -->
                <div id="emailVariablesSection" class="form-group" style="display: none;">
                    <label>Verfügbare Variablen</label>
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="variable-item mb-2">
                                        <code>{username}</code> - Instagram Benutzername
                                    </div>
                                    <div class="variable-item mb-2">
                                        <code>{full_name}</code> - Vollständiger Name
                                    </div>
                                    <div class="variable-item mb-2">
                                        <code>{followers}</code> - Follower-Anzahl
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="variable-item mb-2">
                                        <code>{product_name}</code> - Produktname
                                    </div>
                                    <div class="variable-item mb-2">
                                        <code>{product_url}</code> - Produkt-URL
                                    </div>
                                    <div class="variable-item mb-2">
                                        <code>{product_description}</code> - Produktbeschreibung
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('emailCampaignModal')">Abbrechen</button>
                <button type="button" class="btn btn-secondary" id="saveDraftBtn">
                    <i class="fas fa-save"></i> Entwurf speichern
                </button>
                <button type="button" class="btn btn-primary" id="sendEmailFromModalBtn">
                    <i class="fas fa-paper-plane"></i> Email senden
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Expose data to JavaScript -->
    <script>
        window.leadsData = {{ leads | tojson }};
        window.productsData = {{ products | tojson }};
        window.igSessionId = "{{ ig_sessionid if ig_sessionid else '' }}";
        window.defaultProductId = {{ default_product_id | tojson }};
    </script>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='ui.js') }}"></script>
    <script src="{{ url_for('static', filename='kl-influence-app.js') }}"></script>
</body>
</html>